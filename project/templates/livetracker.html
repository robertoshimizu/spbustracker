    {%  extends 'layout.html' %}

    {% block body %}

        <h1 class="display-6" style="text-align: center;padding: 10px">Live Tracker All Sao Paulo Bus Lines</h1>
        <div style="padding: 12px;">
            <div id="mapid" style="width:1600px;height:800px;margin-left: auto; margin-right: auto;"></div>
        </div>

        <script>


            //const mytoken = import('../params/params')
                //.then(value => console.log('value:' + value))
                //.catch(e => console.log(e)); // token is protected

            const mymap = L.map('mapid').setView([-23.602422, -46.624105], 15);
            L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
                maxZoom: 18,
                id: 'mapbox/streets-v11',
                tileSize: 512,
                zoomOffset: -1,
                accessToken:
            }).addTo(mymap);

            // Capturar o evento vindo do Flask / Stream
            var source;
            source = new EventSource('/alllines',{withCredentials:false});
            console.log('source: ' + source.url);
            console.log('open: ' + source.OPEN);

            //source.onmessage = function(event) {
              //console.log("New message", event.data);
              // will log 3 times for the data stream above
            //};

            source.addEventListener("notice", function(e) {
                console.log(e.data)
            });
            source.addEventListener("update", function(e) {
                console.log(e.data)
            });

            var busMarkers = {};
            source.addEventListener("message", function(e) {
                //const newElement = document.createElement('p');
                //const eventList = document.getElementById('list');
                //newElement.innerHTML = e.data;
                //eventList.appendChild(newElement);
                //console.log(e.data);
                obj = JSON.parse(e.data);

                //console.log(obj.l);

                var linhas = obj.l;

                //console.log(busMarkers);

                linhas.forEach((linha)=>{

                    //console.log(linha.c);
                    var carros = linha.vs;
                    //console.log(carros);
                    carros.forEach((carro)=>{
                        if (busMarkers[carro.p] != null){
                            busMarkers[carro.p].remove();
                        }
                        busMarkers[carro.p] = L.marker([carro.py, carro.px],{title: 'carro '+carro.p});
                        busMarkers[carro.p].addTo(mymap);

                    });
                    //    busMarkers[linha.p].remove();
                    //}
                    //busMarkers[linha.p] = L.marker([linha.py, linha.px],{title: 'carro '+linha.p});
                    //busMarkers[linha.p].addTo(mymap);
                });
            }, false);

            // Parametros do mapa, id=mapid



        </script>

    {% endblock %}